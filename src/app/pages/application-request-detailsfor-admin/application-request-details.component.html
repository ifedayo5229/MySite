<div class="details-page">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>description</mat-icon>
      </div>
      <div class="header-info">
        <h1>{{ selectedApplication?.applicationName }}</h1>
        <span class="status-badge" [ngClass]="getStatusClass(selectedApplication?.status)">
          {{ selectedApplication?.status }}
        </span>
      </div>
    </div>
    <button class="back-btn" routerLink="/home/dashboard">
      <mat-icon>arrow_back</mat-icon>
      Back to Dashboard
    </button>
  </div>

  <!-- Details Card -->
  <div class="details-card">
    <div class="card-title">
      <mat-icon>info</mat-icon>
      <h2>Application Details</h2>
    </div>
    
    <div class="details-grid">
      <div class="detail-item">
        <div class="detail-label">Application Name</div>
        <div class="detail-value">{{ selectedApplication?.applicationName }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Application Type</div>
        <div class="detail-value">{{ selectedApplication?.applicationType }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Justification</div>
        <div class="detail-value">{{ selectedApplication?.justification }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Explanation</div>
        <div class="detail-value">{{ selectedApplication?.explanation }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Department</div>
        <div class="detail-value">{{ selectedApplication?.functionName || selectedApplication?.department }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Location</div>
        <div class="detail-value">{{ selectedApplication?.locationName }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Requester</div>
        <div class="detail-value">{{ selectedApplication?.requester }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Request Date</div>
        <div class="detail-value">{{ selectedApplication?.requestDate | date:'short' }}</div>
      </div>
      
      <div class="detail-item">
        <div class="detail-label">Created Date</div>
        <div class="detail-value">{{ selectedApplication?.createdDate | date:'short' }}</div>
      </div>
    </div>
    
    <button 
      *ngIf="selectedApplication?.status == 'Pending Application Team Review'"
      class="review-btn"
      (click)="markAsReviewed()"
    >
      <mat-icon>task_alt</mat-icon>
      Mark as Reviewed
    </button>
  </div>

<!-- Documents Card -->
  <div class="documents-card" *ngIf="selectedApplication?.documents">
    <div class="card-header" (click)="showDocuments = !showDocuments">
      <div class="header-left">
        <mat-icon>folder_open</mat-icon>
        <h2>Attached Documents</h2>
      </div>
      <mat-icon class="toggle-icon" [class.rotated]="showDocuments">expand_more</mat-icon>
    </div>
    
    <div class="documents-content" *ngIf="showDocuments">
      <div class="upload-section">
        <div class="file-input-wrapper">
          <input
            type="file"
            multiple
            (change)="onFileSelected($event)"
            id="fileUpload"
          />
        </div>
        <button 
          class="upload-btn" 
          (click)="uploadFiles()" 
          [disabled]="!selectedFiles.length">
          Upload Files
        </button>
      </div>
      
      <div class="documents-list" *ngIf="selectedApplication?.documents?.length > 0">
        <div *ngFor="let doc of selectedApplication.documents" class="document-card">
          <div class="document-info">
            <mat-icon>insert_drive_file</mat-icon>
            <div class="document-details">
              <div class="document-name">{{ doc.fileName }}</div>
              <div class="document-meta">
                <span><mat-icon>person</mat-icon>{{ doc.createdBy }}</span>
                <span><mat-icon>schedule</mat-icon>{{ doc.createdDate | date: 'short' }}</span>
              </div>
            </div>
          </div>
          <a [href]="getDocumentUrl(doc)" target="_blank" class="download-btn">
            <mat-icon>download</mat-icon>
            Download
          </a>
        </div>
      </div>
      
      <div *ngIf="selectedApplication?.documents?.length === 0" class="no-documents">
        <mat-icon>folder_off</mat-icon>
        <p>No documents attached yet</p>
      </div>
    </div>
  </div>




<!-- Comments Card -->
  <div class="comments-card">
    <div class="card-header">
      <mat-icon>comment</mat-icon>
      <h2>Comments</h2>
    </div>
    
    <div class="chat-container">
      <div class="chat-messages">
        <div *ngFor="let c of comments" 
             class="message"
             [ngClass]="{
               'own-message': c.createdBy.toLowerCase() === email.toLowerCase(),
               'other-message': c.createdBy.toLowerCase() !== email.toLowerCase()
             }">
          <div class="message-avatar">
            <mat-icon>person</mat-icon>
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-author">{{ getFirstName(c.createdBy) }}</span>
              <span class="message-date">{{ c.createdDate | date: 'short' }}</span>
            </div>
            <div class="message-bubble">
              {{ c.comment }}
            </div>
          </div>
        </div>
        
        <div *ngIf="comments?.length === 0" class="no-comments">
          <mat-icon>chat_bubble_outline</mat-icon>
          <p>No comments yet. Be the first to comment!</p>
        </div>
      </div>
      
      <div class="comment-input">
        <textarea
          [(ngModel)]="newComment"
          placeholder="Write a comment..."
          rows="2"
        ></textarea>
        <button class="send-btn" (click)="submitComment()" [disabled]="!newComment.trim()">
          <mat-icon>send</mat-icon>
          Send
        </button>
      </div>
    </div>
  </div>

</div>
